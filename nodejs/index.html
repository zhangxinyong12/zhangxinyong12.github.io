<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>nodejs-get-post-请求探索 | 学习记录</title>
    <meta name="description" content="学习记录">
    <script async="async" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script> (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-8620617039148215",
            enable_page_level_ads: true
        });</script>
    
    <link rel="preload" href="/assets/css/0.styles.28c2b2ab.css" as="style"><link rel="preload" href="/assets/js/app.e7111907.js" as="script"><link rel="preload" href="/assets/js/7.35ac85c3.js" as="script"><link rel="prefetch" href="/assets/js/2.d3912edf.js"><link rel="prefetch" href="/assets/js/3.fe19e7ba.js"><link rel="prefetch" href="/assets/js/4.1db5612c.js"><link rel="prefetch" href="/assets/js/5.5b012009.js"><link rel="prefetch" href="/assets/js/6.3bd4d964.js"><link rel="prefetch" href="/assets/js/8.dde3f876.js">
    <link rel="stylesheet" href="/assets/css/0.styles.28c2b2ab.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">学习记录</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/es6+/" class="nav-link">es6+</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">linux和nginx</a></li><li class="dropdown-item"><!----> <a href="/ng/" class="nav-link">框架</a></li><li class="dropdown-item"><!----> <a href="/nodejs/" class="nav-link router-link-exact-active router-link-active">node后端</a></li></ul></div></div><div class="nav-item"><a href="https://www.github.com/zhangxinyong12" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/es6+/" class="nav-link">es6+</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">linux和nginx</a></li><li class="dropdown-item"><!----> <a href="/ng/" class="nav-link">框架</a></li><li class="dropdown-item"><!----> <a href="/nodejs/" class="nav-link router-link-exact-active router-link-active">node后端</a></li></ul></div></div><div class="nav-item"><a href="https://www.github.com/zhangxinyong12" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>nodejs-get-post-请求探索</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/nodejs/#koa代码" class="sidebar-link">koa代码</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/nodejs/#axios" class="sidebar-link">axios</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="nodejs-get-post-请求探索"><a href="#nodejs-get-post-请求探索" aria-hidden="true" class="header-anchor">#</a> nodejs-get-post-请求探索</h1> <h2 id="koa代码"><a href="#koa代码" aria-hidden="true" class="header-anchor">#</a> koa代码</h2> <pre><code>const koa = require('koa');
const fs = require('fs');
const app = new koa();

const Router = require('koa-router');

const cors = require('koa2-cors');
const koaBody = require('koa-body'); //解析文件流
app.use(koaBody({
multipart: true,  // 运行多个文件
strict: true,  //默认true，不解析GET,HEAD,DELETE请求
formidable: {
    maxFileSize: 2 * 1024 * 1024   // 设置上传文件大小最大限制，默认2M
}
}));

// const bodyParser = require('koa-bodyparser');  // 不支持 form-data
// app.use(bodyParser({
//   extendTypes: {
//     json: ['application/x-javascript', 'application/x-www-form-urlencoded', 'multipart/form-data', 'text/xml'] // 支持的类型
//   }
// })); // post 获取参数

// 
app.use(cors({
origin: function (ctx) {
    if (ctx.url === '/test') {
    return &quot;*&quot;; // 允许来自所有域名请求
    }
    return &quot;*&quot;; // 允许来自所有域名请求
    // return 'http://localhost:8080'; // 这样就能只允许 http://localhost:8080 这个域名的请求了
},
exposeHeaders: ['WWW-Authenticate', 'Server-Authorization'],
maxAge: 0,
credentials: true,
allowMethods: ['GET', 'PUT', 'POST', 'PATCH', 'DELETE', 'HEAD', 'OPTIONS'],
allowHeaders: ['Content-Type', 'Authorization', 'Accept'],
}));

// 主路由
let home = new Router();
home.get('/', async (ctx) =&gt; {
let url = ctx.url;
let request = ctx.request;
let req_query = request.query;
let req_queryString = request.querystring;
const body = {
    url,
    req_query,
    req_queryString,
};
ctx.body = body;
});

// 子路由
let page = new Router();

page.get('/404', async (ctx) =&gt; {
ctx.body = '404.page!';
})
.get('/helloworld', async (ctx) =&gt; {
    ctx.body = 'hello world page';
})
.get('/init', async (ctx) =&gt; {
    ctx.body = ctx.request.query;
})
.post('/post', async (ctx) =&gt; {
    console.log(ctx.request.query); // 获取 url 后面参数
    const { a, b } = ctx.request.body;
    const body = {
    a, b
    };
    ctx.body = body;
})
.post('/postForm', async (ctx) =&gt; {
    const { a, b } = ctx.request.body;
    const body = {
    a, b
    };
    ctx.body = body;
})
.post('/postText', async (ctx) =&gt; { // text/xml
    const body = `
    &lt;a href=&quot;http://www.baidu.com&quot;&gt;百度链接&lt;/a&gt;
    `;
    ctx.body = body;
})
.post('/uploadfile', async (ctx) =&gt; { //  上传文件
    const file = ctx.request.files.file; // 获取上传文件
    const size = file.size; // 大小
    const type = file.type; // 类型
    const name = file.name; // 名字
    console.log(size, type, name);

    ctx.body = { name };
});


// 装载所有子路由
let router = new Router();
router.use('/', home.routes(), home.allowedMethods());
router.use('/test', page.routes(), page.allowedMethods());

// 加载路由中间件
app.use(router.routes()).use(router.allowedMethods());

app.listen(3000, () =&gt; {
console.log('启动成功');
});
</code></pre> <h2 id="axios"><a href="#axios" aria-hidden="true" class="header-anchor">#</a> axios</h2> <pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;
    &lt;title&gt;Document&lt;/title&gt;
    &lt;script src=&quot;https://unpkg.com/axios/dist/axios.min.js&quot;&gt;&lt;/script&gt;
    &lt;style&gt;
        li{
            height: 40px;
            margin-top: 10px;
            cursor: pointer;
        }
    &lt;/style&gt;
&lt;/head&gt;

&lt;body&gt;

    &lt;input type=&quot;file&quot; name=&quot;a&quot; id=&quot;file&quot;&gt;
    &lt;button type=&quot;submit&quot; onclick=&quot;sub()&quot;&gt;提交,文件上传形式&lt;/button&gt;
    &lt;ul&gt;
        &lt;li onclick=&quot;post_json()&quot;&gt;一般的json形式，最常见&lt;/li&gt;
        &lt;li onclick=&quot;post_form()&quot;&gt;form表单形式&lt;/li&gt;
        &lt;li onclick=&quot;post_text()&quot;&gt;text形式-不常用&lt;/li&gt;
        &lt;li onclick=&quot;get_init()&quot;&gt;get请求&lt;/li&gt;
    &lt;/ul&gt;
    &lt;div id=&quot;box&quot;&gt;
        &lt;h3&gt;请求结果&lt;/h3&gt;

    &lt;/div&gt;
&lt;/body&gt;
&lt;script&gt;
    const box = document.querySelector('#box');
    // axios.defaults.headers.common['Authorization'] = 'zhangxinyong'; // 自定义头信息
    // 注意 不要写axios.defaults.headers.post 这样无效
    // axios.defaults.headers['Content-Type'] = 'application/x-www-form-urlencoded'; //  默认的form表单就是这种形式
    // axios.defaults.headers['Content-Type'] = 'multipart/form-data'; // 对文件分割上传
    // axios.defaults.headers['Content-Type'] = 'application/json'; // 最常见的方式。
    // axios.defaults.headers['Content-Type'] = 'text/xml'; // 不常见

    const url = 'http://127.0.0.1:3000/';
    axios.get(url + '?a=4&amp;b=4').then((res) =&gt; {
        console.log(res.data);
    });
    function get_init() {
        axios.get(url + 'test/init?a=4&amp;b=4').then((res) =&gt; {
            console.log(res.data);
        });
    }
    function post_json() {
        const config = {
            headers: {
                'Content-Type': 'application/json'
            }
        };
        axios.post(url + 'test/post?x=json', { a: 3, b: 4 }, config).then((res) =&gt; {
            console.log(res.data);
        });
    }
    // 一般的form 表单形式
    function post_form() {
        const config = {
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            }
        };
        const formData = new FormData();
        formData.append('a', 4444444);
        formData.append('b', 33333);
        axios.post(url + 'test/postForm?x=form', formData, config).then((res) =&gt; {
            console.log(res.data);
        });
    }
    // multipart/form-data 
    function sub() {
        const formData = new FormData();
        formData.append('file', document.querySelector('#file').files[0]);
        formData.append('type', 2);
        const config = {
            headers: {
                'Content-Type': 'multipart/form-data'
            }
        };
        axios.post(url + 'test/uploadfile', formData, config).then((res) =&gt; {
            console.log(res.data);
        });
    }

    // text 不常用。就不介绍了
    function post_text() {
        const config = {
            headers: {
                'Content-Type': 'text/xml'
            }
        };
        axios.post(url + 'test/postText?x=text', { a: 3, b: 4 }, config).then((res) =&gt; {
            box.innerHTML += res.data;
        });
    }

    // const http = axios.create({
    //     url: 'test/post?x=uuuuuuuu',
    //     baseURL: url,
    //     mthod: 'post',
    //     params: { a: 33, b: 000 }, // url 拼接的
    //     data: {
    //         x: 'cans'
    //     },
    //     // headers: {
    //     //     'Content-Type': 'text/xml'
    //     // }
    // });
    // http.post(url + 'test/post?x=uuuuuuuu', { a: 3, b: 4 }).then((res) =&gt; {
    //     console.log(res.data);
    // });
&lt;/script&gt;

&lt;/html&gt;
</code></pre></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.e7111907.js" defer></script><script src="/assets/js/7.35ac85c3.js" defer></script>
  </body>
</html>
