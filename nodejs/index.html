<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>nodejs-get-post-请求探索 | 日常记录</title>
    <meta name="description" content="好的习惯会使人受益终生">
    <script async="async" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script> (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-8620617039148215",
            enable_page_level_ads: true
        });</script>
    
    <link rel="preload" href="/assets/css/0.styles.9655a05e.css" as="style"><link rel="preload" href="/assets/js/app.ec2b402b.js" as="script"><link rel="preload" href="/assets/js/2.c582e56d.js" as="script"><link rel="prefetch" href="/assets/js/3.584a3d78.js"><link rel="prefetch" href="/assets/js/4.f62e723c.js"><link rel="prefetch" href="/assets/js/5.8562b78c.js"><link rel="prefetch" href="/assets/js/6.71d9c05e.js"><link rel="prefetch" href="/assets/js/7.e4a53b01.js"><link rel="prefetch" href="/assets/js/8.d98d0679.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9655a05e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">日常记录</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/es6+/" class="nav-link">es6+</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">linux和nginx</a></li><li class="dropdown-item"><!----> <a href="/ng/" class="nav-link">框架</a></li><li class="dropdown-item"><!----> <a href="/nodejs/" class="nav-link router-link-exact-active router-link-active">node后端</a></li></ul></div></div><div class="nav-item"><a href="https://www.github.com/zhangxinyong12" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">博文</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/es6+/" class="nav-link">es6+</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">linux和nginx</a></li><li class="dropdown-item"><!----> <a href="/ng/" class="nav-link">框架</a></li><li class="dropdown-item"><!----> <a href="/nodejs/" class="nav-link router-link-exact-active router-link-active">node后端</a></li></ul></div></div><div class="nav-item"><a href="https://www.github.com/zhangxinyong12" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <!----> </div> <div class="page"> <div class="content"><p></p><div class="table-of-contents"><ul><li><a href="#koa代码">koa代码</a></li><li><a href="#axios">axios</a></li><li><a href="#axios请求携带cookie报错">axios请求携带cookie报错</a></li><li><a href="#js-丢失精度">js 丢失精度</a></li><li><a href="#spa页面不缓存index-html">spa页面不缓存index.html</a></li></ul></div><p></p> <h1 id="nodejs-get-post-请求探索"><a href="#nodejs-get-post-请求探索" aria-hidden="true" class="header-anchor">#</a> nodejs-get-post-请求探索</h1> <h2 id="koa代码"><a href="#koa代码" aria-hidden="true" class="header-anchor">#</a> koa代码</h2> <pre><code>const koa = require('koa');
const fs = require('fs');
const app = new koa();

const Router = require('koa-router');

const cors = require('koa2-cors');
const koaBody = require('koa-body'); //解析文件流
app.use(koaBody({
multipart: true,  // 运行多个文件
strict: true,  //默认true，不解析GET,HEAD,DELETE请求
formidable: {
    maxFileSize: 2 * 1024 * 1024   // 设置上传文件大小最大限制，默认2M
}
}));

// const bodyParser = require('koa-bodyparser');  // 不支持 form-data
// app.use(bodyParser({
//   extendTypes: {
//     json: ['application/x-javascript', 'application/x-www-form-urlencoded', 'multipart/form-data', 'text/xml'] // 支持的类型
//   }
// })); // post 获取参数

// 
app.use(cors({
origin: function (ctx) {
    if (ctx.url === '/test') {
    return &quot;*&quot;; // 允许来自所有域名请求
    }
    return &quot;*&quot;; // 允许来自所有域名请求
    // return 'http://localhost:8080'; // 这样就能只允许 http://localhost:8080 这个域名的请求了
},
exposeHeaders: ['WWW-Authenticate', 'Server-Authorization'],
maxAge: 0,
credentials: true,
allowMethods: ['GET', 'PUT', 'POST', 'PATCH', 'DELETE', 'HEAD', 'OPTIONS'],
allowHeaders: ['Content-Type', 'Authorization', 'Accept'],
}));

// 主路由
let home = new Router();
home.get('/', async (ctx) =&gt; {
let url = ctx.url;
let request = ctx.request;
let req_query = request.query;
let req_queryString = request.querystring;
const body = {
    url,
    req_query,
    req_queryString,
};
ctx.body = body;
});

// 子路由
let page = new Router();

page.get('/404', async (ctx) =&gt; {
ctx.body = '404.page!';
})
.get('/helloworld', async (ctx) =&gt; {
    ctx.body = 'hello world page';
})
.get('/init', async (ctx) =&gt; {
    ctx.body = ctx.request.query;
})
.post('/post', async (ctx) =&gt; {
    console.log(ctx.request.query); // 获取 url 后面参数
    const { a, b } = ctx.request.body;
    const body = {
    a, b
    };
    ctx.body = body;
})
.post('/postForm', async (ctx) =&gt; {
    const { a, b } = ctx.request.body;
    const body = {
    a, b
    };
    ctx.body = body;
})
.post('/postText', async (ctx) =&gt; { // text/xml
    const body = `
    &lt;a href=&quot;http://www.baidu.com&quot;&gt;百度链接&lt;/a&gt;
    `;
    ctx.body = body;
})
.post('/uploadfile', async (ctx) =&gt; { //  上传文件
    const file = ctx.request.files.file; // 获取上传文件
    const size = file.size; // 大小
    const type = file.type; // 类型
    const name = file.name; // 名字
    console.log(size, type, name);

    ctx.body = { name };
});


// 装载所有子路由
let router = new Router();
router.use('/', home.routes(), home.allowedMethods());
router.use('/test', page.routes(), page.allowedMethods());

// 加载路由中间件
app.use(router.routes()).use(router.allowedMethods());

app.listen(3000, () =&gt; {
console.log('启动成功');
});
</code></pre> <h2 id="axios"><a href="#axios" aria-hidden="true" class="header-anchor">#</a> axios</h2> <pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;ie=edge&quot;&gt;
    &lt;title&gt;Document&lt;/title&gt;
    &lt;script src=&quot;https://unpkg.com/axios/dist/axios.min.js&quot;&gt;&lt;/script&gt;
    &lt;style&gt;
        li{
            height: 40px;
            margin-top: 10px;
            cursor: pointer;
        }
    &lt;/style&gt;
&lt;/head&gt;

&lt;body&gt;

    &lt;input type=&quot;file&quot; name=&quot;a&quot; id=&quot;file&quot;&gt;
    &lt;button type=&quot;submit&quot; onclick=&quot;sub()&quot;&gt;提交,文件上传形式&lt;/button&gt;
    &lt;ul&gt;
        &lt;li onclick=&quot;post_json()&quot;&gt;一般的json形式，最常见&lt;/li&gt;
        &lt;li onclick=&quot;post_form()&quot;&gt;form表单形式&lt;/li&gt;
        &lt;li onclick=&quot;post_text()&quot;&gt;text形式-不常用&lt;/li&gt;
        &lt;li onclick=&quot;get_init()&quot;&gt;get请求&lt;/li&gt;
    &lt;/ul&gt;
    &lt;div id=&quot;box&quot;&gt;
        &lt;h3&gt;请求结果&lt;/h3&gt;

    &lt;/div&gt;
&lt;/body&gt;
&lt;script&gt;
    const box = document.querySelector('#box');
    // axios.defaults.headers.common['Authorization'] = 'zhangxinyong'; // 自定义头信息
    // 注意 不要写axios.defaults.headers.post 这样无效
    // axios.defaults.headers['Content-Type'] = 'application/x-www-form-urlencoded'; //  默认的form表单就是这种形式
    // axios.defaults.headers['Content-Type'] = 'multipart/form-data'; // 对文件分割上传
    // axios.defaults.headers['Content-Type'] = 'application/json'; // 最常见的方式。
    // axios.defaults.headers['Content-Type'] = 'text/xml'; // 不常见

    const url = 'http://127.0.0.1:3000/';
    axios.get(url + '?a=4&amp;b=4').then((res) =&gt; {
        console.log(res.data);
    });
    function get_init() {
        axios.get(url + 'test/init?a=4&amp;b=4').then((res) =&gt; {
            console.log(res.data);
        });
    }
    function post_json() {
        const config = {
            headers: {
                'Content-Type': 'application/json'
            }
        };
        axios.post(url + 'test/post?x=json', { a: 3, b: 4 }, config).then((res) =&gt; {
            console.log(res.data);
        });
    }
    // 一般的form 表单形式
    function post_form() {
        const config = {
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            }
        };
        const formData = new FormData();
        formData.append('a', 4444444);
        formData.append('b', 33333);
        axios.post(url + 'test/postForm?x=form', formData, config).then((res) =&gt; {
            console.log(res.data);
        });
    }
    // multipart/form-data 
    function sub() {
        const formData = new FormData();
        formData.append('file', document.querySelector('#file').files[0]);
        formData.append('type', 2);
        const config = {
            headers: {
                'Content-Type': 'multipart/form-data'
            }
        };
        axios.post(url + 'test/uploadfile', formData, config).then((res) =&gt; {
            console.log(res.data);
        });
    }

    // text 不常用。就不介绍了
    function post_text() {
        const config = {
            headers: {
                'Content-Type': 'text/xml'
            }
        };
        axios.post(url + 'test/postText?x=text', { a: 3, b: 4 }, config).then((res) =&gt; {
            box.innerHTML += res.data;
        });
    }

    // const http = axios.create({
    //     url: 'test/post?x=uuuuuuuu',
    //     baseURL: url,
    //     mthod: 'post',
    //     params: { a: 33, b: 000 }, // url 拼接的
    //     data: {
    //         x: 'cans'
    //     },
    //     // headers: {
    //     //     'Content-Type': 'text/xml'
    //     // }
    // });
    // http.post(url + 'test/post?x=uuuuuuuu', { a: 3, b: 4 }).then((res) =&gt; {
    //     console.log(res.data);
    // });
&lt;/script&gt;

&lt;/html&gt;
</code></pre> <h2 id="axios请求携带cookie报错"><a href="#axios请求携带cookie报错" aria-hidden="true" class="header-anchor">#</a> axios请求携带cookie报错</h2> <p><img src="/assets/img/axios-err-cookie.3dc6ece0.png" alt="报错"><br>
翻译一下他的意思就是说携带cookie的时候后台不能设置为 *</p> <div class="language- extra-class"><pre class="language-text"><code>const Koa = require('koa');
 const route = require('koa-route');
 const cors = require('koa-cors');
const app = new Koa();

// app.use(cors());
app.use(cors({
    origin: function (ctx) {
        console.log(ctx);
        if (ctx.url == '/data') { // 携带cookie
            return ctx.header.origin;
        } else {
            return '*';
        }
    },
    exposeHeaders: ['WWW-Authenticate', 'Server-Authorization'],
    maxAge: 5,
    credentials: true,
    allowMethods: ['GET', 'POST', 'DELETE'],
    allowHeaders: ['Content-Type', 'Authorization', 'Accept'],
}));
app.use(route.get('/data', (ctx) =&gt; {
    console.log(ctx);
    ctx.set
    ctx.body = { data: [1, 2, 3, 4, 45, 5] };
    // return new Promise((resolve, reject) =&gt; {
    //     setTimeout(() =&gt; {
    //         resolve(ctx.body = { data: [1, 2, 3, 4, 45, 5] })
    //     }, 1000 * 60 * 2.2);
    // })
}));


app.listen(3000, () =&gt; {
    console.log('启动成功');
});
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>document.cookie = &quot;userId=828&quot;;
document.cookie = &quot;userName=zhangsan&quot;;
console.log(document.cookie);

const URL = 'http://127.0.0.1:3000';
// axios
axios.defaults.withCredentials = true; // 携带cookie
axios(URL + '/data').then((res) =&gt; {
    console.log(res.data);
});
// fetch
fetch(URL + '/data', {
    method: 'GET',
    credentials: 'include' // 允许携带cookie
}).then((res) =&gt; {
    console.log(res.data);
});
</code></pre></div><h1 id="js部分"><a href="#js部分" aria-hidden="true" class="header-anchor">#</a> js部分</h1> <h2 id="js-丢失精度"><a href="#js-丢失精度" aria-hidden="true" class="header-anchor">#</a> js 丢失精度</h2> <pre><code>前端通过ajax请求拿到数据json数据然后在展示到页面。今天发现，后端同学给我说，展示的不对
</code></pre> <p><img src="data:image/png;base64,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" alt="response"> <img src="/assets/img/preview.fd1d897b.png" alt="response"></p> <pre><code>通过上面的图片,可以很清楚的发现，后台返回的和最后转为json的不一样&lt;br&gt;
原因：js的number类型有个最大值（安全值）。即2的53次方， 为9007199254740992。如果超过这个值，那么js会出现不精确的问题。&lt;br&gt;
解决办法：后台返回string
</code></pre> <h1 id="nginx-部分"><a href="#nginx-部分" aria-hidden="true" class="header-anchor">#</a> nginx 部分</h1> <h2 id="spa页面不缓存index-html"><a href="#spa页面不缓存index-html" aria-hidden="true" class="header-anchor">#</a> spa页面不缓存index.html</h2> <pre><code>不缓存 add_header Cache-Control 'no-cache, no-store';  #这个是错误的，这样会造成index.html的js css 都不缓存
location = /index.html {
    add_header Cache-Control &quot;no-cache, no-store&quot;;
}
正确的设置应该是   
Cache-Control:max-age=0
Cache-Control的优先级高于Expires
location = /index.html{
    expires 0; 
}
在客户端向服务端发送http请求时，若返回状态码为304 Not Modified 则表明此次请求为条件请求。在请求头中有两个请求参数：If-Modified-Since 和 If-None-Match。

当客户端缓存了目标资源但不确定该缓存资源是否是最新版本的时候, 就会发送一个条件请求。在进行条件请求时,客户端会提供给服务器一个If-Modified-Since请求头,其值为服务器上次返回响应头中Last-Modified值,还会提供一个If-None-Match请求头,值为服务器上次返回的ETag响应头的值。

服务器会读取到这两个请求头中的值,判断出客户端缓存的资源是否是最新的,如果是的话,服务器就会返回HTTP/304 Not Modified响应头, 但没有响应体.客户端收到304响应后,就会从本地缓存中读取对应的资源。 所以：当访问资源出现304访问的情况下其实就是先在本地缓存了访问的资源。

另一种情况是,如果服务器认为客户端缓存的资源已经过期了,那么服务器就会返回HTTP/200 OK响应,响应体就是该资源当前最新的内容.客户端收到200响应后,就会用新的响应体覆盖掉旧的缓存资源.只有在客户端缓存了对应资源且该资源的响应头中包含了Last-Modified或ETag的情况下,才可能发送条件请求.如果这两个头都不存在,则必须无条件(unconditionally)请求该资源,服务器也就必须返回完整的资源数据.另外，有时候我们浏览器调试的时候不希望本地缓存，可以设置取消缓存即可。
</code></pre> <ul><li>index.html header头做缓存</li></ul> <div class="language- extra-class"><pre class="language-text"><code>没有做测试
&lt;meta http-equiv=&quot;Pragma&quot; content=&quot;no-cache&quot;&gt;
&lt;meta http-equiv=&quot;Cache-Control&quot; content=&quot;no-cache&quot;&gt;
&lt;meta http-equiv=&quot;Expires&quot; content=&quot;0&quot;&gt;
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.ec2b402b.js" defer></script><script src="/assets/js/2.c582e56d.js" defer></script>
  </body>
</html>
